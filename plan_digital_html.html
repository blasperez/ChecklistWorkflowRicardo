<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Digital Integral con Blas - Ejecutivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: {
                            800: '#001f3f',
                            900: '#001830',
                        },
                        sea: {
                            500: '#2E8B57',
                            600: '#246B43',
                        },
                        gold: {
                            400: '#D4AF37',
                            500: '#C5A028',
                            600: '#B08D20',
                        },
                        paper: '#ffffff',
                    },
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    boxShadow: {
                        'paper': '0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)',
                        'paper-lg': '0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* Light Gray Background */
            color: #334155;
            /* Slate 700 */
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }

        h1,
        h2,
        h3 {
            font-family: 'Playfair Display', serif;
            color: #001f3f;
            /* Navy 800 */
        }

        .paper-sheet {
            background-color: #ffffff;
            position: relative;
            margin: 2rem auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05), 0 6px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }

        .paper-sheet::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, #001f3f, #2E8B57, #D4AF37);
        }

        .gold-accent {
            color: #D4AF37;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="min-h-screen p-4 md:p-8">

    <div id="app" class="max-w-5xl mx-auto">

        <!-- Paper Sheet Container -->
        <div class="paper-sheet rounded-sm p-8 md:p-12">

            <!-- Header -->
            <div
                class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12 border-b border-slate-200 pb-8">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-2 tracking-tight">Plan Digital Integral</h1>
                    <p class="text-slate-500 text-lg uppercase tracking-widest text-xs font-semibold">Ejecutivo &bull;
                        Estratégico &bull; Profesional</p>
                </div>

                <!-- Progress Badge -->
                <div class="bg-slate-50 rounded-lg p-4 border border-slate-200 min-w-[200px]">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-navy-800 uppercase tracking-wider">Progreso</span>
                        <span class="text-xs font-bold text-sea-600" id="progress-text">0/0</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
                        <div id="progress-bar" class="bg-sea-500 h-2 rounded-full transition-all duration-700 ease-out"
                            style="width: 0%"></div>
                    </div>
                    <div class="text-right mt-1">
                        <span class="text-2xl font-bold text-navy-800" id="progress-percentage">0%</span>
                    </div>
                </div>
            </div>

            <!-- Connection Status -->
            <div id="connection-status"
                class="text-center mb-8 text-xs font-medium text-slate-400 uppercase tracking-wider">
                <span class="inline-flex items-center gap-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-yellow-500 animate-pulse"></span>
                    Conectando...
                </span>
            </div>

            <!-- Locations List -->
            <div class="space-y-6" id="locations-container">
                <!-- Content will be injected here -->
            </div>

            <!-- Footer -->
            <div class="mt-16 text-center text-slate-400 text-xs border-t border-slate-100 pt-8">
                <p>&copy; 2024 Plan Digital Integral. Documento Oficial.</p>
            </div>

        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCNsx_lDzNZz4-XXNBCL3l9LvzTKvN8N0c",
            authDomain: "spotifylyricstranslator.firebaseapp.com",
            projectId: "spotifylyricstranslator",
            storageBucket: "spotifylyricstranslator.firebasestorage.app",
            messagingSenderId: "459157844682",
            appId: "1:459157844682:web:5f2adf8d72f0e622bffa33"
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const DOC_ID = 'plan-digital-blas-v2';

        // Initial Data Structure
        const initialData = {
            locations: [
                {
                    id: 'phq',
                    name: 'PH de la Quinta San Carlos',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Habilitar screen mirroring para lap top en pantalla sala. Así como desde CEL android y iOS.', completed: false },
                        { id: 2, text: 'Habilitar en las 6 pantallas las cuentas de Netflix, HBOMax, Prime,', completed: false },
                        { id: 3, text: 'Pantalla cuarto Richo screen mirroring para android Cel y habilitar acceso a cámaras de vigilancia desde el televisor.', completed: false },
                        { id: 4, text: 'Habilitar tv terraza para ver partidos y pelis. Conexión con bocinas extras o amplificador o equipo sonido. Todo interconectado.', completed: false },
                        { id: 5, text: 'Colocar cámara de vigilancia en balcón cuarto Richo que mire amplio hacia La Quinta y el lago. Se pueda mover.', completed: false },
                        { id: 6, text: 'Colocar controles de luz de colores en muros.', completed: false },
                        { id: 7, text: 'Instalar el X Box.', completed: false },
                        { id: 8, text: 'Arreglar Air wheel aire y que ensamble y cargue corriente. Inflar rueda y arreglar con tape agarradera. Se trata de una rueda eléctrica.', completed: false },
                        { id: 9, text: 'Esconder cables de todos los aparatos conectados y fijar bien las televisiones.', completed: false },
                        { id: 10, text: 'Configurar las cámaras de vigilancia en Google home en los dos celulares de Richo y TV Richo de PHA y PHQ.', completed: false },
                        { id: 11, text: 'Cotizar y si no es muy caro poner Dimmers en todos los focos de luces directas sala, Richo, Suite.', completed: false },
                        { id: 12, text: 'Cargar y ordenar los drones, leer instrucciones y aprender a volar los drones.', completed: false },
                        { id: 13, text: 'Revisar focos con celdas solares que iluminan las macetas de la terraza.', completed: false },
                        { id: 14, text: 'Registrar huellas digitales de las personas de confianza de las dos chapas digitales.', completed: false },
                        { id: 15, text: 'Colocar chapa digital en elevador para tener acceso restringido al PH.', completed: false },
                        { id: 16, text: 'Arreglar bien los reflectores exteriores que iluminan los árboles y programarlos.', completed: false },
                        { id: 17, text: 'Revisar Jacuzzi de varias fallas.', completed: false }
                    ]
                },
                {
                    id: 'pha',
                    name: 'PHA Penthouse de Guadalajara',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Integrar todas las cámaras internas y externas de los 3 niveles en una sola aplicación o dos.', completed: false },
                        { id: 3, text: 'Modernizar bloquear y desbloquear acceso restringido elevador.', completed: false },
                        { id: 4, text: 'Google home para refrigerador y estufa.', completed: false },
                        { id: 5, text: 'Revisar calentador solar y el calentador eléctrico auxiliar.', completed: false },
                        { id: 6, text: 'Colocar calentadores eléctricos en 3 baños.', completed: false },
                        { id: 7, text: 'Revisar equipo de sonido Bose. Alimentar con música por tipo el disco duro del amplificador.', completed: false }
                    ]
                },
                {
                    id: 'sala-juntas',
                    name: 'SALA DE JUNTAS PHA',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Habilitar bien el screen mirroring con lap top y celular tanto iOS android Windows.', completed: false },
                        { id: 2, text: 'Guardar dispositivos fijos en mueble y esconder cables.', completed: false },
                        { id: 3, text: 'Colocar de manera fija la cámara en la TV para juntas virtuales.', completed: false },
                        { id: 4, text: 'Colocar y configurar bien el módem, router, no break, servidor, etc.', completed: false },
                        { id: 5, text: 'Habilitar bien sensor de movimiento o calor para iluminar pasillo.', completed: false },
                        { id: 6, text: 'Colocar toma de corriente de debajo de la mesa de juntas.', completed: false },
                        { id: 7, text: 'Revisar y reponer sillas giratorias.', completed: false }
                    ]
                },
                {
                    id: 'sala-principal',
                    name: 'SALA PRINCIPAL PHA',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Revisar equipo de sonido Bose y conectarlo con la TV de la misma sala.', completed: false },
                        { id: 2, text: 'Revisar diferentes tipos de iluminación pre programadas en los apagadores.', completed: false },
                        { id: 3, text: 'Colocar servi bar.', completed: false }
                    ]
                },
                {
                    id: 'terraza-americas',
                    name: 'TERRAZA AMERICAS',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Asesoría luces, equipo de sonido, y efectos especiales para disco.', completed: false }
                    ]
                },
                {
                    id: 'cuarto-richo',
                    name: 'CUARTO RICHO PHA',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Habilitar todo el Google home: como encender luces con voz, encender tv, abrir cortinas.', completed: false },
                        { id: 2, text: 'Meter en la TV todas las aplicaciones que operan cámaras de vigilancia.', completed: false },
                        { id: 3, text: 'Habilitar lo que falta de streaming como HBO max en la tv', completed: false },
                        { id: 4, text: 'Motor a control para abrir u cerrar cortinas.', completed: false }
                    ]
                },
                {
                    id: 'celular',
                    name: 'CELULAR RICHO',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Depuración archivos duplicados o triplicados en Google Drive.', completed: false },
                        { id: 2, text: 'Aprender uso óptimo cámara y enseñar a Richo a usarla de mejor manera.', completed: false },
                        { id: 3, text: 'Aprender a operar en el celular con Gemini integrado y maximizar los comandos de voz.', completed: false },
                        { id: 4, text: 'Revisar todos los respaldos en la nube.', completed: false },
                        { id: 5, text: 'Organizar fotos y vídeos, en Google fotos eliminar fotos que vengan del WhatsApp.', completed: false },
                        { id: 6, text: 'Depurar y antes revisar material de archivos de audio, datos, videos, fotos.', completed: false },
                        { id: 7, text: 'Integrar acceso a cámaras de Grupo Tarahumara en Frigo Elote y Lechuga.', completed: false },
                        { id: 8, text: 'Unificar y organizar en una o dos aplicaciones las cámaras de vigilancia.', completed: false }
                    ]
                },
                {
                    id: 'software',
                    name: 'APOYO EN SOFTWARE',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Presentaciones en Power Point o bien modificación a algunas ya hechas.', completed: false },
                        { id: 2, text: 'Excel, elaborar proyecciones o modificaciones a documentos de Excel.', completed: false },
                        { id: 3, text: 'Apoyo en uso de IA como Chat GPT y Gemini para algunos trabajos especiales.', completed: false },
                        { id: 4, text: 'Integrar archivos de Google Earth de diferentes terrenos y propiedades.', completed: false }
                    ]
                },
                {
                    id: 'cdmx',
                    name: 'DEPA CDMX',
                    expanded: true,
                    tasks: [
                        { id: 1, text: 'Poner en la aplicación las dos cámaras existentes.', completed: false },
                        { id: 2, text: 'Habilitar las 3 televisiones con todo: screen mirroring, Netflix, youtube.', completed: false },
                        { id: 3, text: 'Controles remotos de luces de color indirectas.', completed: false },
                        { id: 4, text: 'Motor cortina recámara y dejar bien todas las cortinas.', completed: false }
                    ]
                }
            ]
        };

        let appData = { ...initialData };

        // DOM Elements
        const container = document.getElementById('locations-container');
        const statusEl = document.getElementById('connection-status');

        // Real-time listener
        const docRef = doc(db, 'checklists', DOC_ID);

        onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                appData = docSnap.data();
                statusEl.innerHTML = '<span class="text-sea-600 flex items-center justify-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-sea-500"></span> SINCRONIZADO</span>';
            } else {
                setDoc(docRef, initialData);
                statusEl.innerHTML = '<span class="text-gold-500">INICIALIZANDO...</span>';
            }
            render();
        }, (error) => {
            console.error("Error getting document:", error);
            statusEl.innerHTML = '<span class="text-red-500">ERROR DE CONEXIÓN</span>';
        });

        // Toggle Task
        window.toggleTask = async (locationId, taskId) => {
            const locationIndex = appData.locations.findIndex(l => l.id === locationId);
            if (locationIndex === -1) return;

            const taskIndex = appData.locations[locationIndex].tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;

            const wasCompleted = appData.locations[locationIndex].tasks[taskIndex].completed;
            appData.locations[locationIndex].tasks[taskIndex].completed = !wasCompleted;
            render();

            if (!wasCompleted) {
                confetti({
                    particleCount: 80,
                    spread: 60,
                    origin: { y: 0.7 },
                    colors: ['#D4AF37', '#2E8B57', '#001f3f'],
                    disableForReducedMotion: true
                });
            }

            try {
                await setDoc(docRef, appData);
            } catch (e) {
                console.error("Error saving:", e);
            }
        };

        // Toggle Location Expansion
        window.toggleLocation = async (locationId) => {
            const locationIndex = appData.locations.findIndex(l => l.id === locationId);
            if (locationIndex === -1) return;

            appData.locations[locationIndex].expanded = !appData.locations[locationIndex].expanded;
            render();

            try {
                await setDoc(docRef, appData);
            } catch (e) {
                console.error("Error saving:", e);
            }
        };

        function getProgress(location) {
            const completed = location.tasks.filter(t => t.completed).length;
            const total = location.tasks.length;
            return { completed, total, percentage: total === 0 ? 0 : Math.round((completed / total) * 100) };
        }

        function getTotalProgress() {
            const allTasks = appData.locations.flatMap(loc => loc.tasks);
            const completed = allTasks.filter(t => t.completed).length;
            const total = allTasks.length;
            return { completed, total, percentage: total === 0 ? 0 : Math.round((completed / total) * 100) };
        }

        function render() {
            container.innerHTML = '';

            appData.locations.forEach(location => {
                const progress = getProgress(location);

                const locationDiv = document.createElement('div');
                locationDiv.className = 'border border-slate-200 rounded-lg overflow-hidden hover:border-gold-400 transition-colors duration-300';

                const headerDiv = document.createElement('div');
                headerDiv.className = 'p-5 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors flex items-center justify-between group';
                headerDiv.onclick = () => toggleLocation(location.id);

                headerDiv.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="text-navy-800 transition-transform duration-300 ${location.expanded ? 'rotate-180' : ''}">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-navy-800 group-hover:text-navy-900">${location.name}</h2>
                            <div class="w-full bg-slate-200 rounded-full h-1.5 mt-2 w-32">
                                <div class="bg-sea-500 h-1.5 rounded-full transition-all duration-500" style="width: ${progress.percentage}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-xl font-bold text-navy-800">${progress.percentage}%</span>
                        <p class="text-xs text-slate-500 font-medium">${progress.completed}/${progress.total}</p>
                    </div>
                `;

                locationDiv.appendChild(headerDiv);

                if (location.expanded) {
                    const tasksDiv = document.createElement('div');
                    tasksDiv.className = 'bg-white p-2';

                    location.tasks.forEach(task => {
                        const taskDiv = document.createElement('div');
                        taskDiv.className = `flex items-start gap-3 p-3 rounded-md transition-all cursor-pointer hover:bg-slate-50 ${task.completed ? 'opacity-75' : ''
                            }`;
                        taskDiv.onclick = () => toggleTask(location.id, task.id);

                        taskDiv.innerHTML = `
                            <div class="flex-shrink-0 mt-1">
                                <div class="w-5 h-5 rounded border flex items-center justify-center transition-all ${task.completed
                                ? 'bg-sea-500 border-sea-500'
                                : 'border-slate-300 hover:border-gold-400'
                            }">
                                    ${task.completed
                                ? '<svg width="12" height="12" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>'
                                : ''
                            }
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm leading-relaxed ${task.completed ? 'text-slate-400 line-through' : 'text-slate-700'}">${task.text}</p>
                            </div>
                        `;

                        tasksDiv.appendChild(taskDiv);
                    });

                    locationDiv.appendChild(tasksDiv);
                }

                container.appendChild(locationDiv);
            });

            // Update Total Progress
            const totalProgress = getTotalProgress();
            document.getElementById('progress-text').textContent = `${totalProgress.completed}/${totalProgress.total}`;
            document.getElementById('progress-bar').style.width = `${totalProgress.percentage}%`;
            document.getElementById('progress-percentage').textContent = `${totalProgress.percentage}%`;
        }
    </script>
</body>

</html>